{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template local_totp/view_page

    TOTP view page template with circular progress bar

    Context variables required for this template:
    * totp - The TOTP code
    * remaining - Remaining seconds
    * period - Validity period in seconds
    * courseid - Course ID
    * circumference - SVG circle circumference
    * dashoffset - SVG stroke-dashoffset for progress

    Example context (json):
    {
        "totp": "123456",
        "remaining": 25,
        "period": 30,
        "courseid": 2,
        "circumference": 691,
        "dashoffset": 115
    }
}}
<div class="container my-5" data-courseid="{{courseid}}" data-period="{{period}}" data-circumference="{{circumference}}">
    <div class="row justify-content-center">
        <div class="col-md-8 col-lg-6">
            <div class="card shadow-sm position-relative">
                <button class="btn btn-sm btn-secondary position-absolute"
                        data-action="open-popup"
                        data-courseid="{{courseid}}"
                        title="{{#str}}openpopup, local_totp{{/str}}"
                        style="top: 0.5rem; right: 0.5rem; z-index: 10;">
                    <i class="fa fa-external-link" aria-hidden="true"></i>
                    <span class="sr-only">{{#str}}openpopup, local_totp{{/str}}</span>
                </button>

                <div class="card-body text-center p-4">
                    <h2 class="card-title h4 mb-4">{{#str}}totp, local_totp{{/str}}</h2>

                    <div class="totp-circle-wrapper position-relative d-inline-block">
                        <svg class="totp-progress-ring d-block" width="240" height="240" viewBox="0 0 240 240">
                            <circle class="totp-progress-ring__circle-bg text-secondary"
                                    stroke="currentColor"
                                    stroke-width="8"
                                    fill="transparent"
                                    r="110"
                                    cx="120"
                                    cy="120"/>
                            <circle id="totp-progress-circle"
                                    class="totp-progress-ring__circle text-primary"
                                    stroke="currentColor"
                                    stroke-width="8"
                                    fill="transparent"
                                    r="110"
                                    cx="120"
                                    cy="120"
                                    style="stroke-dasharray: {{circumference}} {{circumference}}; stroke-dashoffset: {{dashoffset}};"/>
                        </svg>
                        <div class="totp-code-overlay">
                            <div id="totp-code" class="fw-bold font-monospace">{{totp}}</div>
                        </div>
                    </div>

                    <div class="text-muted small mt-3">
                        <span id="totp-remaining">{{remaining}}</span> {{#str}}secondsremaining, local_totp{{/str}}
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{{#js}}
require(['local_totp/totp_refresh', 'local_totp/popup_opener'], function(TotpRefresh, PopupOpener) {
    TotpRefresh.init({{courseid}}, {{period}}, {{circumference}});
    PopupOpener.init();
});
{{/js}}
